%!TEX root = nextndnvideo-tr.tex
\vspace{0.3cm}
\section{Design} % (fold)
\label{sec:arch}
NDNLive and NDNTube are all based on Consumer / Producer API over Named Data Networking. They contain two kinds of roles - producer and consumer. According to the content production and data retrieval pattern, their architecture and namespace will be described separately in this section. 

\paragraph{NDNLive Architecture} % (fold)
\vspace{0.3cm}
\label{par:ndnlive_arch}
The architecture of NDNLive is shown as (Figure~\ref{fig:ndnlive_arch}), and is illustrated as below:

\begin{itemize}
  \item \textit{Producer}

  NDNLive is \textit{Live Streaming}, which the producer captures video from camera and audio from microphone, then passes them to Gstreamer to get raw data encoded and extract the video and audio frames. At last the frames are published to NDN Network by Consumer / Producer API. 

  \item \textit{Consumer}

  The consumer can send interest asking for the video stream at any time, it will get the latest video and audio frames, then pass them to Gstreamer to get decoded and at the end the player can play them back. 

\end{itemize}



\paragraph{NDNTube Architecture} % (fold)
\vspace{0.3cm}
\label{par:ndntube_arch}
The architecture of NDNLive is shown as (Figure~\ref{fig:ndntube_arch}), and is illustrated as below:
\begin{itemize}
  \item \textit{Producer}

    NDNTube is \textit{Pre-recorded Streaming}, which is more like Youtube. The video source is the pre-recorded video file. As we described in Section~\ref{sec:repo}, the video and audio frames associated with this video file will be written into Repo in advance. And Repo will take over the duty of responding to the Interests requesting for frames. Then there is no need for the frame producer being attached to the NDN Network. 

  \item \textit{Consumer}

    Another difference from NDNLive, in this case the consumer must know what video files the producer has. So the consumer should send Interest asking for the latest playlist and then chose one to play. So the producer only needs to keep publishing the latest playlist containing all the names of video files to the NDN Network.

\end{itemize}


\subsection{Namespace}

NDNLive and NDNTube produce video and audio stream separately. Every single frame need a unique name. And before consuming the video and audio content, it should first use the stream information to set up the playing pipeline. There are many components in common between them. 

\paragraph{NDNLive Naming} % (fold)
\label{par:ndnlive_naming}
\vspace{0.3cm}
The following is an example name of NDNLive. 

\begin{quote}
``/ndn/ucla/ndnlive/stream-1/video/content/8/\%00\%00''
\end{quote}
\begin{itemize}
	\item{\textbf{Routing Prefix:}} ``/ndn/ucla/ndnlive'' is the prefix.
	\item{\textbf{Stream\_ID:}} ``/stream-1'' is a representation for one specific live stream, because there could be several producers under the same prefix to publish different live stream.
	\item{\textbf{Video or Audio:}} ``/video'' is a mark to distinguish video and audio.
	\item{\textbf{Content or Stream\_Info:}} ``/content'' represents the frames and ``/stream\_info'' represents the stream information.
	\item{\textbf{Frame Number:}} ``/8'' is frame number, which stream\_info does not have this component.
	\item{\textbf{Segment Number:}} ``\%00\%00'' is the segment number. Because most video frames would contain more than one segment, this component is essential. As we mentioned before (Section~\ref{ssub:cpapi}), the Consumer / Producer API will do the segmentation processing, so the segment number will be appended by the API automatically. But audio frame in NDNLive is always smaller than one segment. There is no segment number for audio frame, and stream\_info does not have this component, neither.
\end{itemize}

Then we can conclude that the above name stands for a piece of data which is the segment 0 inside the 8th video frame of stream-1 under the prefix of /ndn/ucla/ndnlive. 

The relative stream information name is shown as below:
\begin{quote}
``ndn/ucla/ndnlive/stream-1/video/stream\_info/ \\\ 1428725107049''
\end{quote}

Because the stream\_info would contain the current frame number of video and audio. And the consumer always want to retrieve the latest stream\_info to set up the pipeline and also the current frame number to start consuming from this number. So we append a timestamp component at the end of stream\_info to help the consumer retrieve the latest one.

The whole namespace of NDNLive should look like Figure~\ref{fig:ndnlive_naming}.

\begin{figure}%[htbp]
  \centering
  \includegraphics[scale=0.3]{ndnlive_naming}
  % \vspace{-0.3cm}
  \caption{NDNLive Namespace}
  \label{fig:ndnlive_naming}
  %\vspace{-0.2cm}
\end{figure}
% paragraph ndnlive_naming (end)
\paragraph{NDNTube Naming} % (fold)
\label{par:ndntube_naming}
\vspace{0.3cm}

The namespace of NDNTube is very similar to NDNLive. There are four differences:
\begin{enumerate}
	\item{\textit{Playlist added}} 
		
		NDNTube will have a playlist component, which NDNLive does not. The name example is shown as below: 
		\begin{quote}
		``/ndn/ucla/ndntube/playlist/1428725107042''
		\end{quote}
    Because the playlist can be changed at anytime as long as a new file is added or deleted. The consumer always wants to retrieve the latest one. We append a timestamp component at the end to distinguish the obsolete and latest playlist.

	\item{\textit{Video\_Name instead of Stream\_ID}} 

		We should set a component to specific one video file instead of a live stream\_id.

	\item{\textit{No Timestamp under Stream\_Info}} 

    In NDNTube the related stream information of one video file is fixed (basic information to set up the pipeline and the final frame number marked as the \textit{EOS} of the video file), so there is no need to add the timestamp component.

	\item{\textit{Audio also needs Segment\_Number}} 

    The audio frames may also contain more than one segments, because it's not under our control (We control the audio frame small enough for NDNLive), the quality of MP4 file will influence the size of audio frames.
\end{enumerate}

The whole namespace of NDNTube is shown as Figure~\ref{fig:ndntube_naming}.

\begin{figure}%[htbp]
  \centering
  \includegraphics[scale=0.3]{ndntube_naming}
  % \vspace{-0.3cm}
  \caption{NDNTube Namespace}
  \label{fig:ndntube_naming}
  %\vspace{-0.2cm}
\end{figure}
% paragraph ndntube_naming (end)

% section section_name (end)
%%% Local Variables:
%%% mode: latex
%%% TeX-master: "nextndnvideo-tr"
%%% End:
